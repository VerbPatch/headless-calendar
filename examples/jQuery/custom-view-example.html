<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>jQuery Calendar Custom View Example</title>
  </head>

  <body style="font-family: sans-serif; padding: 20px">
    <h1>jQuery Calendar Custom View Example</h1>
    <div id="calendar-app">
      <div>
        <button id="prev">Prev</button>
        <button id="today">Today</button>
        <button id="next">Next</button>
        <span style="margin-left: 20px"><strong id="range-label"></strong></span>
      </div>

      <div style="margin: 20px 0">
        <strong>Presets:</strong>
        <button class="preset" data-type="day" data-count="2">2 Days</button>
        <button class="preset" data-type="week" data-count="1" data-include="1,2,3,4,5">
          Work Week
        </button>
        <button class="preset" data-type="week" data-count="2">2 Weeks</button>
        <button class="preset" data-type="month" data-count="1" data-include="1,2,3,4,5">
          1 Month (WD)
        </button>
        <button class="preset" data-type="month" data-count="3">Quarter</button>
      </div>

      <div id="calendar-view"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@verbpatch/jquery-calendar/dist/index.umd.js"></script>
    <script>
      $(document).ready(function () {
        const $calContainer = $('#calendar-app');
        const $view = $('#calendar-view');
        const $label = $('#range-label');

        let customOptions = { type: 'day', count: 2 };

        function initCalendar() {
          $calContainer.headlessCalendar({
            defaultView: 'custom',
            customViewOptions: customOptions,
            initialEvents: [
              // 1. A hour event
              {
                id: '1',
                title: 'Project Review',
                start: new Date(),
                end: new Date(new Date().getTime() + 3600000),
                color: '#8b5cf6',
              },
              // 2. A hour lunch event
              {
                id: '2',
                title: 'Lunch Sync',
                start: new Date(new Date().setHours(12, 0)),
                end: new Date(new Date().setHours(13, 0)),
                color: '#10b981',
              },
              // 3. Multi-day event
              {
                id: '3',
                title: 'Business Trip',
                start: new Date(new Date().setHours(9, 0, 0, 0)),
                end: new Date(
                  new Date(new Date().getTime() + 2 * 24 * 60 * 60 * 1000).setHours(17, 0, 0, 0),
                ),
                color: '#10b981',
              },
              {
                id: '4',
                title: 'Daily Standup',
                start: new Date(new Date().setHours(10, 0, 0, 0)),
                end: new Date(new Date().setHours(10, 30, 0, 0)),
                color: '#f59e0b',
                recurring: {
                  repeat: 'weekly',
                  every: 1,
                  weekDays: [1, 2, 3, 4, 5], // Mon-Fri
                },
              },
              // 5. Weekly recurring event
              {
                id: '5',
                title: 'Weekly Planning',
                start: new Date(new Date().setHours(14, 0, 0, 0)),
                end: new Date(new Date().setHours(15, 0, 0, 0)),
                color: '#8b5cf6',
                recurring: {
                  repeat: 'weekly',
                  every: 1,
                  weekDays: [1], // Monday
                  end: new Date(new Date().getFullYear(), 11, 31),
                },
              },
              // 6. Monthly by day
              {
                id: '6',
                title: 'Monthly Payday',
                start: new Date(new Date().setDate(25)),
                end: new Date(new Date().setDate(25)),
                allDay: true,
                color: '#ec4899',
                recurring: {
                  repeat: 'monthly',
                  every: 1,
                  day: 25,
                },
              },
              // 7. Monthly by week position (2nd Friday)
              {
                id: '7',
                title: 'Team Lunch',
                start: new Date(new Date().setHours(12, 0, 0, 0)),
                end: new Date(new Date().setHours(13, 0, 0, 0)),
                color: '#6366f1',
                recurring: {
                  repeat: 'monthly',
                  every: 1,
                  week: 2,
                  weekDays: [5], // Friday
                },
              },
              // 8. Yearly recurring
              {
                id: '8',
                title: 'New Year Party',
                start: new Date(new Date().getFullYear(), 0, 1),
                end: new Date(new Date().getFullYear(), 0, 1),
                allDay: true,
                color: '#f43f5e',
                recurring: {
                  repeat: 'yearly',
                  every: 1,
                  month: 0, // Jan
                  day: 1,
                },
              },
              // 9. Rich metadata
              {
                id: '9',
                title: 'Client Demo',
                start: new Date(new Date().setHours(15, 0, 0, 0)),
                end: new Date(new Date().setHours(16, 0, 0, 0)),
                description: 'Demo of the new product features.\nSee attachment for details.',
                location: 'Conference Room A',
                url: 'https://example.com/meeting',
                color: '#06b6d4',
              },
              // 10. Timezone specific
              {
                id: '10',
                title: 'Global Sync',
                start: new Date(new Date().setHours(20, 0, 0, 0)),
                end: new Date(new Date().setHours(21, 0, 0, 0)),
                description: 'Late night sync for global teams',
                color: '#64748b',
                timezone: 'America/New_York',
              },
            ],
            onRender: function (calendar) {
              renderHTML(calendar);
            },
          });
        }

        function getTitle(cal) {
          const opts = cal.customViewOptions;
          if (!opts) return '';
          if (opts.type === 'month') return cal.monthData?.monthName;
          if (opts.type === 'week') return cal.weekData?.weekRange;
          return cal.dayData?.dayName;
        }

        function renderHTML(calendar) {
          const utils = calendar.utils;
          $label.text(getTitle(calendar));

          let html = '';
          const opts = calendar.customViewOptions;

          if (opts.type === 'month' && calendar.monthData) {
            const count = opts.count || 1;
            for (let i = 0; i < count; i++) {
              const mDate = utils.addMonths(calendar.currentDate, i);
              const m = mDate.getMonth();
              const y = mDate.getFullYear();

              html += `<div><h3>${utils.formatLocalizedMonth(mDate)}</h3>`;
              html +=
                '<table border="1" cellpadding="5" width="100%" style="border-collapse: collapse; text-align: center;"><thead><tr>';
              utils.daysofWeek('short').forEach((day) => (html += `<th>${day}</th>`));
              html += '</tr></thead><tbody>';

              calendar.monthData.weeks.forEach((week) => {
                if (!week.some((d) => d.getMonth() === m && d.getFullYear() === y)) return;

                html += '<tr>';
                [0, 1, 2, 3, 4, 5, 6].forEach((dayIdx) => {
                  const date = week.find((d) => d.getDay() === dayIdx);
                  const isInMonth = date && date.getMonth() === m && date.getFullYear() === y;
                  const isToday = date && utils.isSameDay(date, new Date());

                  if (isInMonth) {
                    const events = calendar.getEventsForDate(date);
                    html += `<td style="height: 80px; vertical-align: top; background: ${isToday ? '#eee' : 'transparent'}">`;
                    html += `<div><strong>${date.getDate()}</strong></div>`;
                    events.forEach(
                      (e) =>
                        (html += `<div style="border: 1px solid; font-size: 10px; margin-bottom: 2px;background: ${e.color || '#ccc'};color:#fff;">${e.title}</div>`),
                    );
                    html += `</td>`;
                  } else {
                    html += '<td style="background: #f9fafb;"></td>';
                  }
                });
                html += '</tr>';
              });
              html += '</tbody></table></div>';
            }
          } else {
            const data = opts.type === 'week' ? calendar.weekData : calendar.dayData;
            if (data) {
              html +=
                '<table border="1" cellpadding="5" width="100%" style="border-collapse: collapse; text-align: center;"><thead><tr>';
              data.dates.forEach((date) => {
                html += `<th>${utils.formatDate(date, 'EEE d')}</th>`;
              });
              html += '</tr></thead><tbody><tr>';
              data.dates.forEach((date) => {
                const isToday = utils.isSameDay(date, new Date());
                const events = calendar.getEventsForDate(date);
                html += `<td style="height: 100px; vertical-align: top; background: ${isToday ? '#eee' : 'transparent'}">`;
                events.forEach(
                  (e) =>
                    (html += `<div style="border: 1px solid; font-size: 11px; margin-bottom: 2px;background: ${e.color || '#ccc'};color:#fff;">${e.title}</div>`),
                );
                html += `</td>`;
              });
              html += '</tr></tbody></table>';
            }
          }
          $view.html(html);
        }

        $('#prev').click(() => $calContainer.headlessCalendar('goToPrevious'));
        $('#today').click(() => $calContainer.headlessCalendar('goToToday'));
        $('#next').click(() => $calContainer.headlessCalendar('goToNext'));

        $('.preset').click(function () {
          const type = $(this).data('type');
          const count = parseInt($(this).data('count'));
          const include = $(this).data('include')
            ? $(this).data('include').toString().split(',').map(Number)
            : undefined;
          $calContainer.headlessCalendar('changeView', 'custom', {
            type,
            count,
            includeSpecificDays: include,
          });
        });

        initCalendar();
      });
    </script>
  </body>
</html>
