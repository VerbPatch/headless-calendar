<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jQuery HeadlessCalendar - Advanced Custom View Demo</title>

</head>

<body>
    <table border="1" class="container" style="border-collapse: collapse; width:800px; height:800px; margin:auto;">

        <thead>
            <tr>
                <td>
                    <table>
                        <tr class=" header">
                            <th style="display: flex; gap: 8px;">
                                <button id="prev">Previous</button>
                                <button id="today">Today</button>
                                <button id="next">Next</button>
                            </th>
                        </tr>

                        <tr class="controls">
                            <td>
                                <strong>View Presets:</strong>
                                <button class="preset" data-unit="day" data-count="2">2 Days</button>
                                <button class="preset" data-unit="week" data-count="1" data-include="1,2,3,4,5">Work
                                    Week</button>
                                <button class="preset" data-unit="week" data-count="2">2 Weeks</button>
                                <button class="preset" data-unit="month" data-count="1" data-include="1,2,3,4,5">1 Month
                                    week
                                    days</button>
                                <button class="preset" data-unit="month" data-count="3">Quarter (3 Months)</button>
                            </td>
                        </tr>
                    </table>

                </td>
            </tr>

        </thead>

        <tbody>
            <tr>
                <td id="calendar-view"></td>
            </tr>
        </tbody>
    </table>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="../../packages/jquery-calendar/dist/index.umd.js"></script>
    <script>
        $(document).ready(function () {
            const $calContainer = $('#calendar-view');
            $calContainer.headlessCalendar({
                defaultDate: new Date(2026, 0, 1),
                defaultView: 'custom',
                customViewOptions: { unit: 'day', count: 2 },
                initialEvents: [
                    { title: 'Project Review', start: new Date(), end: new Date(new Date().getTime() + 3600000), color: '#8b5cf6' },
                    { title: 'Lunch Sync', start: new Date(new Date().setHours(12, 0)), end: new Date(new Date().setHours(13, 0)), color: '#10b981' }
                ],
                onRender: function (calendar) {
                    const utils = calendar.utils;

                    let title = "";
                    let html = "";

                    if (calendar.monthData) {
                        title = calendar.monthData.monthName;
                        const isMultiMonth = calendar.view === 'custom' &&
                            calendar.customViewOptions.unit === 'month' &&
                            calendar.customViewOptions.count > 1;

                        const monthsToDisplay = [];
                        const count = isMultiMonth ? calendar.customViewOptions.count : 1;

                        for (let i = 0; i < count; i++) {
                            const d = utils.addMonths(calendar.currentDate, i);
                            monthsToDisplay.push({
                                month: d.getMonth(),
                                year: d.getFullYear(),
                                date: d
                            });
                        }

                        monthsToDisplay.forEach(m => {
                            const monthName = utils.formatLocalizedMonth(m.date);
                            html += `<div class="month-title" style="margin-top: 20px; font-weight: bold; font-size: 1.2em;">${monthName}</div>`;
                            html += '<table border=1 cellspacing="0" cellpadding="5" style="border-collapse: collapse; width:800px;  margin:auto;"><thead><tr>';
                            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => html += `<th>${day}</th>`);
                            html += '</tr></thead><tbody>';

                            calendar.monthData.weeks.forEach(week => {
                                const hasDaysInMonth = week.some(d => d.getMonth() === m.month && d.getFullYear() === m.year);
                                if (!hasDaysInMonth) return;

                                html += '<tr>';
                                [0, 1, 2, 3, 4, 5, 6].forEach(dayIndex => {
                                    const date = week.find(d => d.getDay() === dayIndex);
                                    if (date && date.getMonth() === m.month && date.getFullYear() === m.year) {
                                        const isToday = utils.isSameDay(date, new Date());
                                        const events = calendar.getEventsForDate(date);

                                        html += `<td class="${isToday ? 'today' : ''}" style="height: 80px;">`;
                                        html += `<div class="day-header"><span class="day-num">${date.getDate()}</span></div>`;
                                        html += `<div class="events">`;
                                        events.forEach(e => html += `<div class="event" style="background:${e.color}; margin-bottom: 2px; color: white; padding: 2px; font-size: 10px; border-radius: 2px;">${e.title}</div>`);
                                        html += `</div></td>`;
                                    } else {
                                        html += '<td style="background: #f8fafc;"></td>';
                                    }
                                });
                                html += '</tr>';
                            });
                            html += '</tbody></table>';
                        });
                    }
                    else if (calendar.weekData) {
                        title = calendar.weekData.weekRange;
                        html += '<table border=1 cellspacing="0" cellpadding="5" style="border-collapse: collapse; width:800px;  margin:auto;"><tbody>';

                        for (let i = 0; i < calendar.weekData.dates.length; i += 7) {
                            html += '<tr>';
                            const week = calendar.weekData.dates.slice(i, i + 7);
                            week.forEach(date => {
                                const isToday = utils.isSameDay(date, new Date());
                                const events = calendar.getEventsForDate(date);
                                html += `<td class="${isToday ? 'today' : ''}" style="height: 100px;">`;
                                html += `<div class="day-header"><span class="day-name">${utils.formatDate(date, 'EEE')}</span> <span class="day-num">${date.getDate()}</span></div>`;
                                html += `<div class="events">`;
                                events.forEach(e => html += `<div class="event" style="background:${e.color}">${e.title}</div>`);
                                html += `</div></td>`;
                            });
                            html += '</tr>';
                        }
                        html += '</tbody></table>';

                    }
                    else if (calendar.dayData) {
                        title = calendar.dayData.dayName;
                        html += '<table border=1 cellspacing="0" cellpadding="5" style="border-collapse: collapse; width:800px;  margin:auto;"><tbody>';

                        const dates = calendar.dayData.dates;
                        const rowSize = dates.length > 7 ? 7 : dates.length;

                        for (let i = 0; i < dates.length; i += rowSize) {
                            html += '<tr>';
                            const row = dates.slice(i, i + rowSize);
                            row.forEach(date => {
                                const isToday = utils.isSameDay(date, new Date());
                                const events = calendar.getEventsForDate(date);
                                html += `<td class="${isToday ? 'today' : ''}" style="height: 100px; width: ${100 / rowSize}%">`;
                                html += `<div class="day-header"><span class="day-name">${utils.formatDate(date, 'EEE')}</span> <span class="day-num">${date.getDate()}</span></div>`;
                                html += `<div class="events">`;
                                events.forEach(e => html += `<div class="event" style="background:${e.color}">${e.title}</div>`);
                                html += `</div></td>`;
                            });
                            html += '</tr>';
                        }
                        html += '</tbody></table>';
                    }

                    $('#range-label').text(title);
                    $calContainer.html(html);
                }
            });

            $('#prev').click(() => $calContainer.headlessCalendar('goToPrevious'));
            $('#next').click(() => $calContainer.headlessCalendar('goToNext'));
            $('#today').click(() => $calContainer.headlessCalendar('goToToday'));

            $('.preset').click(function () {
                const unit = $(this).data('unit');
                const count = parseInt($(this).data('count'));
                const include = $(this).data('include');
                const options = { unit, count };

                if (include) {
                    options.includeSpecificDays = include.toString().split(',').map(Number);
                } else {
                    options.includeSpecificDays = undefined;
                }

                $calContainer.headlessCalendar('setCustomViewOptions', options);
            });
        });
    </script>
</body>

</html>