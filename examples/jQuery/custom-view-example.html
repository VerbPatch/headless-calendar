<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>jQuery Calendar Custom View Example</title>
  </head>

  <body style="font-family: sans-serif; padding: 20px">
    <h1>jQuery Calendar Custom View Example</h1>
    <div id="calendar-app">
      <div>
        <button id="prev">Prev</button>
        <button id="today">Today</button>
        <button id="next">Next</button>
        <span style="margin-left: 20px"><strong id="range-label"></strong></span>
      </div>

      <div style="margin: 20px 0">
        <strong>Presets:</strong>
        <button class="preset" data-type="day" data-count="2">2 Days</button>
        <button class="preset" data-type="week" data-count="1" data-include="1,2,3,4,5">
          Work Week
        </button>
        <button class="preset" data-type="week" data-count="2">2 Weeks</button>
        <button class="preset" data-type="month" data-count="1" data-include="1,2,3,4,5">
          1 Month (WD)
        </button>
        <button class="preset" data-type="month" data-count="3">Quarter</button>
      </div>

      <div id="calendar-view"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@verbpatch/jquery-calendar/dist/index.umd.js"></script>
    <script>
      const tzDate = new Date(new Date().setHours(20, 0, 0, 0));
      const tzEndDate = new Date(new Date().setHours(21, 0, 0, 0));
      $(document).ready(function () {
        const $calContainer = $('#calendar-app');
        const $view = $('#calendar-view');
        const $label = $('#range-label');

        let customOptions = { type: 'day', count: 2 };

        function initCalendar() {
          $calContainer.headlessCalendar({
            defaultView: 'custom',
            customViewOptions: customOptions,
            initialEvents: [
              {
                id: '1',
                title: 'Simple Meeting',
                description: 'Single-day 1 hour event',
                start: new Date(new Date().setHours(9, 0, 0, 0)),
                end: new Date(new Date().setHours(10, 0, 0, 0)),
                color: '#E6194B',
              },
              {
                id: '2',
                title: 'Company Holiday',
                description: 'All-day event',
                start: new Date(),
                end: new Date(),
                allDay: true,
                color: '#FFE119',
              },
              {
                id: '3',
                title: 'Business Trip',
                description: 'Multi-day event',
                start: new Date(new Date().setHours(9, 0, 0, 0)),
                end: new Date(
                  new Date(new Date().getTime() + 2 * 24 * 60 * 60 * 1000).setHours(17, 0, 0, 0),
                ),
                color: '#4363D8',
              },
              {
                id: '4',
                title: 'Daily Standup',
                description: 'Daily Standup (Weekdays only)',
                start: new Date(new Date().setHours(10, 0, 0, 0)),
                end: new Date(new Date().setHours(10, 30, 0, 0)),
                color: '#F58231',
                recurring: {
                  repeat: 'weekly',
                  every: 1,
                  weekDays: [1, 2, 3, 4, 5],
                },
              },
              {
                id: '5',
                title: 'Weekly Planning',
                description: 'Weekly recurring event',
                start: new Date(new Date().setHours(14, 0, 0, 0)),
                end: new Date(new Date().setHours(15, 0, 0, 0)),
                color: '#911EB4',
                recurring: {
                  repeat: 'weekly',
                  every: 1,
                  weekDays: [1],
                  end: new Date(new Date().getFullYear(), 11, 31),
                },
              },
              {
                id: '6',
                title: 'Monthly Payday',
                description: 'Monthly by day 25',
                start: new Date(new Date().setDate(25)),
                end: new Date(new Date().setDate(25)),
                allDay: true,
                color: '#42D4F4',
                recurring: {
                  repeat: 'monthly',
                  every: 1,
                  day: 25,
                },
              },
              {
                id: '7',
                title: 'Team Lunch',
                description: 'Monthly by week position (2nd Friday)',
                start: new Date(new Date().setHours(12, 0, 0, 0)),
                end: new Date(new Date().setHours(13, 0, 0, 0)),
                color: '#F032E6',
                recurring: {
                  repeat: 'monthly',
                  every: 1,
                  week: 2,
                  weekDays: [5],
                },
              },
              {
                id: '8',
                title: 'New Year Party',
                description: 'Yearly recurring',
                start: new Date(new Date().getFullYear(), 0, 1),
                end: new Date(new Date().getFullYear(), 0, 1),
                allDay: true,
                color: '#9A6324',
                recurring: {
                  repeat: 'yearly',
                  every: 1,
                  month: 0,
                  day: 1,
                },
              },
              {
                id: '9',
                title: 'Client Demo',
                description: 'Rich metadata',
                start: new Date(new Date().setHours(15, 0, 0, 0)),
                end: new Date(new Date().setHours(16, 0, 0, 0)),
                description: 'Demo of the new product features.\nSee attachment for details.',
                location: 'Conference Room A',
                url: 'https://example.com/meeting',
                color: '#000075',
              },
              {
                id: '10',
                title: 'Global Sync',
                description: `Late night sync for global teams, Timezone specific -> Actual event is ${tzDate.toDateString()} ${tzDate.toTimeString().substring(0, 8)} - ${tzEndDate.toDateString()} ${tzEndDate.toTimeString().substring(0, 8)} in America/New_York timezone, translated to local calendar timezone.`,
                start: tzDate,
                end: tzEndDate,
                color: '#64748b',
                timezone: 'America/New_York',
              },
              {
                id: '11',
                title: 'Daily Huddle (Excl. specific days)',
                description: 'Recurring with EXDATE (Exclude specific dates)',
                start: new Date(new Date().setHours(9, 30, 0, 0)),
                end: new Date(new Date().setHours(9, 45, 0, 0)),
                color: '#db2777',
                recurring: {
                  repeat: 'daily',
                  every: 1,
                },
                exdate: [
                  new Date(new Date().setDate(new Date().getDate() + 2)),
                  new Date(new Date().setDate(new Date().getDate() + 4)),
                ],
              },
              {
                id: '12',
                title: 'Ad-hoc Review',
                description: 'Recurring with RDATE (Additional dates)',
                start: new Date(new Date().setHours(13, 0, 0, 0)),
                end: new Date(new Date().setHours(14, 0, 0, 0)),
                color: '#d97706',
                recurring: {
                  repeat: 'weekly',
                  every: 1,
                  weekDays: [3],
                },
                rdate: [new Date(new Date().setDate(new Date().getDate() + 1))],
              },

              {
                id: '13',
                title: 'Tentative Monthly Sync',
                description: 'Test: Strict RFC RRULE with Status & Transparency',
                start: new Date(new Date().setHours(11, 0, 0, 0)),
                end: new Date(new Date().setHours(12, 0, 0, 0)),
                color: '#7c3aed',

                recurring: {
                  repeat: 'monthly',
                  every: 1,
                  byDay: ['1FR'],
                },
                status: 'TENTATIVE',
                transparency: 'TRANSPARENT',
              },
              {
                id: '14',
                title: 'Rescheduled Instance',
                description:
                  'This specific instance was moved to 3pm, Recurrence Exception (RECURRENCE-ID) representation',
                start: new Date(new Date().setHours(15, 0, 0, 0)),
                end: new Date(new Date().setHours(16, 0, 0, 0)),
                color: '#059669',
                recurrenceId: new Date(new Date().setHours(14, 0, 0, 0)),
              },
            ],
            onRender: function (calendar) {
              renderHTML(calendar);
            },
          });
        }

        function getTitle(cal) {
          const opts = cal.customViewOptions;
          if (!opts) return '';
          if (opts.type === 'month') return cal.monthData?.monthName;
          if (opts.type === 'week') return cal.weekData?.weekRange;
          return cal.dayData?.dayName;
        }

        function renderHTML(calendar) {
          const utils = calendar.utils;
          $label.text(getTitle(calendar));

          let html = '';
          const opts = calendar.customViewOptions;

          if (opts.type === 'month' && calendar.monthData) {
            const count = opts.count || 1;
            for (let i = 0; i < count; i++) {
              const mDate = utils.addMonths(calendar.currentDate, i);
              const m = mDate.getMonth();
              const y = mDate.getFullYear();

              html += `<div><h3>${utils.formatLocalizedMonth(mDate)}</h3>`;
              html +=
                '<table border="1" cellpadding="5" width="100%" style="border-collapse: collapse; text-align: center;"><thead><tr>';
              utils.daysofWeek('short').forEach((day) => (html += `<th>${day}</th>`));
              html += '</tr></thead><tbody>';

              calendar.monthData.weeks.forEach((week) => {
                if (!week.some((d) => d.getMonth() === m && d.getFullYear() === y)) return;

                html += '<tr>';
                [0, 1, 2, 3, 4, 5, 6].forEach((dayIdx) => {
                  const date = week.find((d) => d.getDay() === dayIdx);
                  const isInMonth = date && date.getMonth() === m && date.getFullYear() === y;
                  const isToday = date && utils.isSameDay(date, new Date());

                  if (isInMonth) {
                    const events = calendar.getEventsForDate(date);
                    html += `<td style="height: 80px; vertical-align: top; background: ${isToday ? '#eee' : 'transparent'}">`;
                    html += `<div><strong>${date.getDate()}</strong></div>`;
                    events.forEach(
                      (e) =>
                        (html += `<div style="border: 1px solid; font-size: 10px; margin-bottom: 2px;background: ${e.color || '#ccc'};color:#fff;">${e.title}</div>`),
                    );
                    html += `</td>`;
                  } else {
                    html += '<td style="background: #f9fafb;"></td>';
                  }
                });
                html += '</tr>';
              });
              html += '</tbody></table></div>';
            }
          } else {
            const data = opts.type === 'week' ? calendar.weekData : calendar.dayData;
            if (data) {
              html +=
                '<table border="1" cellpadding="5" width="100%" style="border-collapse: collapse; text-align: center;"><thead><tr>';
              data.dates.forEach((date) => {
                html += `<th>${utils.formatDate(date, 'EEE d')}</th>`;
              });
              html += '</tr></thead><tbody><tr>';
              data.dates.forEach((date) => {
                const isToday = utils.isSameDay(date, new Date());
                const events = calendar.getEventsForDate(date);
                html += `<td style="height: 100px; vertical-align: top; background: ${isToday ? '#eee' : 'transparent'}">`;
                events.forEach(
                  (e) =>
                    (html += `<div style="border: 1px solid; font-size: 11px; margin-bottom: 2px;background: ${e.color || '#ccc'};color:#fff;">${e.title}</div>`),
                );
                html += `</td>`;
              });
              html += '</tr></tbody></table>';
            }
          }
          $view.html(html);
        }

        $('#prev').click(() => $calContainer.headlessCalendar('goToPrevious'));
        $('#today').click(() => $calContainer.headlessCalendar('goToToday'));
        $('#next').click(() => $calContainer.headlessCalendar('goToNext'));

        $('.preset').click(function () {
          const type = $(this).data('type');
          const count = parseInt($(this).data('count'));
          const include = $(this).data('include')
            ? $(this).data('include').toString().split(',').map(Number)
            : undefined;
          $calContainer.headlessCalendar('changeView', 'custom', {
            type,
            count,
            includeSpecificDays: include,
          });
        });

        initCalendar();
      });
    </script>
  </body>
</html>
