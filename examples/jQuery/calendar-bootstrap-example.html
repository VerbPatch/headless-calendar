<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>jQuery HeadlessCalendar - Full Featured Demo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    /* Minimal, light theme adjustments */
    body {
      background: #f8f9fa;
      color: #222;
      font-family:
        system-ui,
        -apple-system,
        'Segoe UI',
        Roboto,
        'Helvetica Neue',
        Arial;
      padding: 2rem 0;
    }

    .page-card {
      max-width: 980px;
      margin: 0 auto;
      border-radius: 8px;
      overflow: visible;
    }

    .card-body {
      padding: 1.25rem;
    }

    .toolbar-row {
      align-items: center;
      gap: 0.5rem;
    }

    #currentDate {
      font-weight: 600;
      color: #495057;
    }

    /* Calendar area */
    #calendar {
      background: #ffffff;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      min-height: 420px;
      padding: 12px;
      margin-top: 1rem;
    }

    .month-view {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      align-items: start;
    }

    .weekday-header {
      font-size: 12px;
      font-weight: 600;
      color: #6c757d;
      text-align: center;
      padding: 6px 4px;
      background: #f1f3f5;
      border-radius: 6px;
    }

    .day-cell {
      background: #fff;
      border: 1px solid #f1f3f5;
      border-radius: 6px;
      min-height: 86px;
      padding: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .day-number {
      font-size: 13px;
      color: #495057;
      text-align: right;
      font-weight: 600;
    }

    .day-cell.other-month {
      color: #adb5bd;
      background: #fbfbfb;
    }

    .day-cell.today {
      background: #eef6ff;
      border: 1px solid #cfe2ff;
      box-shadow: inset 0 0 0 2px rgba(102, 119, 234, 0.06);
    }

    .event-badge {
      display: block;
      padding: 4px 6px;
      border-radius: 4px;
      color: #fff;
      font-size: 12px;
      line-height: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Sidebar simplified */
    .sidebar .card {
      border: 0;
      background: transparent;
      padding: 0;
    }

    .stats-panel .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px dashed #eee;
      font-size: 14px;
    }

    .events-list .event-item {
      border-left: 4px solid transparent;
      padding: 8px;
      margin-bottom: 8px;
      background: #fff;
      border-radius: 6px;
      border: 1px solid #f1f3f5;
      font-size: 14px;
    }

    /* Modal mimic (keeps your original JS which toggles .active) */
    #eventModal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.35);
      align-items: center;
      justify-content: center;
      z-index: 1050;
    }

    #eventModal.active {
      display: flex;
    }

    #eventModal .modal-content {
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      width: 420px;
      max-width: calc(100% - 32px);
    }

    .success-message {
      position: fixed;
      right: 20px;
      bottom: 20px;
      background: #198754;
      color: #fff;
      padding: 10px 14px;
      border-radius: 6px;
      box-shadow: 0 6px 18px rgba(25, 135, 84, 0.12);
      z-index: 1100;
    }

    /* small helpers */
    .toolbar .view-switcher button {
      margin-right: 0.25rem;
    }

    /* make form controls use bootstrap look */
    input[type='text'],
    input[type='datetime-local'],
    textarea,
    select,
    input[type='color'] {
      width: 100%;
      padding: 0.375rem 0.5rem;
      border: 1px solid #ced4da;
      border-radius: 0.375rem;
      font-size: 0.9rem;
      box-sizing: border-box;
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid transparent;
    }

    @media (max-width: 767px) {
      .month-view {
        grid-template-columns: repeat(7, 1fr);
      }

      .page-card {
        margin: 1rem;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>üóìÔ∏è jQuery HeadlessCalendar</h1>
      <p>A fully-featured calendar plugin with drag & drop, event management, and more!</p>
    </div>

    <div class="toolbar">
      <div class="nav-group">
        <button class="btn btn-secondary" id="prevBtn">‚Üê Prev</button>
        <button class="btn btn-primary" id="todayBtn">Today</button>
        <button class="btn btn-secondary" id="nextBtn">Next ‚Üí</button>
      </div>

      <div class="current-date" id="currentDate">Loading...</div>

      <div class="view-switcher">
        <button data-view="day">Day</button>
        <button data-view="week">Week</button>
        <button data-view="month" class="active">Month</button>
      </div>
    </div>

    <div class="main-content">
      <div class="calendar-section">
        <div id="calendar" class="loading">Loading calendar</div>
      </div>

      <div class="sidebar">
        <!-- Event Form -->
        <div class="event-form">
          <h4>‚ûï Add New Event</h4>
          <div class="form-group">
            <label>Event Title *</label>
            <input type="text" id="eventTitle" placeholder="Meeting, Birthday, etc." />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Start Date & Time *</label>
              <input type="datetime-local" id="eventStart" title="Event Start" />
            </div>
            <div class="form-group">
              <label>End Date & Time *</label>
              <input type="datetime-local" id="eventEnd" title="Event End" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Color</label>
              <input type="color" id="eventColor" value="#667eea" title="Event Color" />
            </div>
            <div class="form-group">
              <label>All Day</label>
              <select id="eventAllDay" title="Event Type">
                <option value="false">No</option>
                <option value="true">Yes</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea id="eventDesc" rows="2" placeholder="Optional description..."></textarea>
          </div>
          <button class="btn btn-success" id="addEventBtn" style="width: 100%">Add Event</button>
        </div>

        <!-- Stats Panel -->
        <div class="stats-panel">
          <h4>üìä Statistics</h4>
          <div class="stat-item">
            <span class="stat-label">Total Events</span>
            <span class="stat-value" id="totalEvents">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">This Month</span>
            <span class="stat-value" id="monthEvents">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Upcoming</span>
            <span class="stat-value" id="upcomingEvents">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Current View</span>
            <span class="stat-value" id="currentView">month</span>
          </div>
        </div>

        <!-- Events List -->
        <div class="events-list">
          <h4>üìã Upcoming Events</h4>
          <div id="eventsList"></div>
        </div>

        <!-- Quick Actions -->
        <div class="form-group">
          <button class="btn btn-info" id="addSampleEvents" style="width: 100%; margin-bottom: 10px">
            Add Sample Events
          </button>
          <button class="btn btn-danger" id="clearAllEvents" style="width: 100%">
            Clear All Events
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Event Details Modal -->
  <div class="modal" id="eventModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">Event Details</h3>
        <button class="modal-close" id="modalClose">√ó</button>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@verbpatch/jquery-calendar/dist/index.umd.js"></script>

  <script>
    $(document).ready(function () {
      console.log('Initializing calendar...');

      const getSampleEvents = () => {
        const today = new Date();
        return [
          {
            title: 'üéØ Team Meeting',
            start: new Date(today.getFullYear(), today.getMonth(), 5, 10, 0),
            end: new Date(today.getFullYear(), today.getMonth(), 5, 11, 30),
            color: '#667eea',
            description: 'Weekly team sync-up meeting',
          },
          {
            title: 'üöÄ Project Launch',
            start: new Date(today.getFullYear(), today.getMonth(), 15, 14, 0),
            end: new Date(today.getFullYear(), today.getMonth(), 15, 16, 0),
            color: '#f56565',
            description: 'New product launch event',
          },
          {
            title: 'üçï Lunch with Client',
            start: new Date(today.getFullYear(), today.getMonth(), 8, 12, 30),
            end: new Date(today.getFullYear(), today.getMonth(), 8, 14, 0),
            color: '#48bb78',
            description: 'Client meeting at Italian restaurant',
          },
          {
            title: 'üíº Board Meeting',
            start: new Date(today.getFullYear(), today.getMonth(), 20, 9, 0),
            end: new Date(today.getFullYear(), today.getMonth(), 20, 11, 0),
            color: '#ed8936',
            description: 'Quarterly board meeting',
          },
          {
            title: 'üéâ Company Party',
            start: new Date(today.getFullYear(), today.getMonth(), 25, 18, 0),
            end: new Date(today.getFullYear(), today.getMonth(), 25, 22, 0),
            color: '#9f7aea',
            description: 'End of month celebration',
          },
        ];
      };

      $('#calendar').headlessCalendar({
        defaultView: 'month',
        startOfWeek: 0,
        initialEvents: getSampleEvents(),
        onRender: function (calendar) {
          console.log('Calendar rendered:', calendar);
          renderCalendar();
          updateStats();
          updateEventsList();
        },
        onEventCreate: function (event) {
          console.log('Event created:', event);
          showSuccess('Event created successfully!');
          renderCalendar();
          updateStats();
          updateEventsList();
        },
        onEventUpdate: function (event) {
          console.log('Event updated:', event);
          showSuccess('Event updated successfully!');
        },
        onEventDelete: function (event) {
          console.log('Event deleted:', event);
          showSuccess('Event deleted successfully!');
        },
        onViewChange: function (view) {
          console.log('View changed to:', view);
          updateViewButtons(view);
          renderCalendar();
          updateStats();
        },
        onDateChange: function (date) {
          console.log('Date changed to:', date);
          renderCalendar();
          updateStats();
        },
      });

      $('#prevBtn').on('click', function () {
        $('#calendar').headlessCalendar('goToPrevious');
      });

      $('#nextBtn').on('click', function () {
        $('#calendar').headlessCalendar('goToNext');
      });

      $('#todayBtn').on('click', function () {
        $('#calendar').headlessCalendar('goToToday');
      });

      $('.view-switcher button').on('click', function () {
        const view = $(this).data('view');
        $('#calendar').headlessCalendar('changeView', view);
      });

      $('#addEventBtn').on('click', function () {
        const title = $('#eventTitle').val().trim();
        const start = new Date($('#eventStart').val());
        const end = new Date($('#eventEnd').val());
        const color = $('#eventColor').val();
        const description = $('#eventDesc').val().trim();
        const allDay = $('#eventAllDay').val() === 'true';

        if (!title) {
          alert('Please enter an event title');
          return;
        }

        if (!$('#eventStart').val() || !$('#eventEnd').val()) {
          alert('Please select start and end times');
          return;
        }

        if (start >= end) {
          alert('End time must be after start time');
          return;
        }

        try {
          $('#calendar').headlessCalendar('createEvent', {
            title: title,
            start: start,
            end: end,
            color: color,
            description: description,
            allDay: allDay,
          });

          $('#eventTitle').val('');
          $('#eventDesc').val('');
          setDefaultDateTime();
        } catch (error) {
          alert('Error creating event: ' + error.message);
        }
      });

      $('#addSampleEvents').on('click', function () {
        const samples = getSampleEvents();
        samples.forEach((event) => {
          try {
            $('#calendar').headlessCalendar('createEvent', event);
          } catch (error) {
            console.error('Error adding sample event:', error);
          }
        });
        showSuccess(samples.length + ' sample events added!');
      });

      $('#clearAllEvents').on('click', function () {
        if (confirm('Are you sure you want to delete all events?')) {
          $('#calendar').headlessCalendar('clearAllEvents');
          renderCalendar();
          updateStats();
          updateEventsList();
          showSuccess('All events cleared!');
        }
      });

      $('#modalClose').on('click', function () {
        $('#eventModal').removeClass('active');
      });

      $('#eventModal').on('click', function (e) {
        if (e.target.id === 'eventModal') {
          $('#eventModal').removeClass('active');
        }
      });

      function renderCalendar() {
        const cal = $('#calendar').headlessCalendar('getCalendar');
        const view = cal.view;

        let html = '';

        if (view === 'month') {
          html = renderMonthView(cal);
        } else if (view === 'week') {
          html = renderWeekView(cal);
        } else if (view === 'day') {
          html = renderDayView(cal);
        }

        $('#calendar').html(html);
        updateCurrentDate(cal);
      }

      function renderMonthView(cal) {
        const monthData = cal.monthData;
        if (!monthData)
          return '<div class="empty-state"><div class="empty-state-icon">üìÖ</div><p>Loading month view...</p></div>';

        let html = '<div class="month-view">';

        const weekdays = cal.utils.daysofWeek('short');
        weekdays.forEach((day) => {
          html += `<div class="weekday-header">${day}</div>`;
        });

        monthData.weeks.forEach((week) => {
          week.forEach((date) => {
            const isToday = cal.utils.isSameDay(date, new Date());
            const isCurrentMonth = monthData.isCurrentMonth(date);
            const events = cal.getEventsForDate(date);

            let className = 'day-cell';
            if (!isCurrentMonth) className += ' other-month';
            if (isToday) className += ' today';

            html += `<div class="${className}" data-date="${date.toISOString()}">`;
            html += `<div class="day-number">${date.getDate()}</div>`;

            events.forEach((event) => {
              html += `<div class="event-badge" style="background:${event.color}" draggable="true" data-event-id="${event.id}">${event.title}</div>`;
            });

            html += '</div>';
          });
        });

        html += '</div>';
        return html;
      }

      function renderWeekView(cal) {
        const weekData = cal.weekData;
        if (!weekData)
          return '<div class="empty-state"><div class="empty-state-icon">üìÖ</div><p>Loading week view...</p></div>';

        let html = '<div style="text-align:center;padding:20px;">';
        html += '<h3 style="margin-bottom:20px;color:#667eea;">Week View</h3>';
        html += '<div style="display:grid;grid-template-columns:repeat(7,1fr);gap:10px;">';

        weekData.dates.forEach((date) => {
          const isToday = weekData.isToday(date);
          const events = cal.getEventsForDate(date);
          const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });

          html +=
            '<div style="background:white;padding:15px;border-radius:8px;border:2px solid ' +
            (isToday ? '#667eea' : '#e0e0e0') +
            ';">';
          html += `<div style="font-weight:bold;color:#667eea;margin-bottom:10px;">${dayName}</div>`;
          html += `<div style="font-size:24px;font-weight:bold;margin-bottom:10px;">${date.getDate()}</div>`;

          if (events.length > 0) {
            html += `<div style="font-size:12px;color:#666;">${events.length} event${events.length > 1 ? 's' : ''}</div>`;
            events.forEach((event) => {
              html += `<div class="event-badge" style="background:${event.color};margin-top:5px;" draggable="true" data-event-id="${event.id}">${event.title}</div>`;
            });
          } else {
            html += '<div style="font-size:12px;color:#999;">No events</div>';
          }

          html += '</div>';
        });

        html += '</div></div>';
        return html;
      }

      function renderDayView(cal) {
        const dayData = cal.dayData;
        if (!dayData)
          return '<div class="empty-state"><div class="empty-state-icon">üìÖ</div><p>Loading day view...</p></div>';

        const events = cal.getEventsForDate(dayData.dates[0]);

        let html = '<div style="text-align:center;padding:20px;">';
        html += '<h3 style="margin-bottom:20px;color:#667eea;">' + dayData.dayName + '</h3>';

        if (events.length > 0) {
          html += '<div style="max-width:600px;margin:0 auto;">';
          events.forEach((event) => {
            const startTime = event.start.toLocaleTimeString('en-US', {
              hour: '2-digit',
              minute: '2-digit',
            });
            const endTime = event.end.toLocaleTimeString('en-US', {
              hour: '2-digit',
              minute: '2-digit',
            });

            html +=
              '<div class="event-item" draggable="true" data-event-id="' +
              event.id +
              '" style="border-left-color:' +
              event.color +
              ';">';
            html += '<div class="event-item-title">' + event.title + '</div>';
            html += '<div class="event-item-time">' + startTime + ' - ' + endTime + '</div>';
            if (event.description) {
              html +=
                '<div style="font-size:12px;color:#666;margin-top:4px;">' +
                event.description +
                '</div>';
            }
            html += '<div class="event-item-actions">';
            html +=
              '<button class="btn btn-info duplicate-event" data-event-id="' +
              event.id +
              '">Duplicate</button>';
            html +=
              '<button class="btn btn-danger delete-event" data-event-id="' +
              event.id +
              '">Delete</button>';
            html += '</div>';
            html += '</div>';
          });
          html += '</div>';
        } else {
          html += '<div class="empty-state">';
          html += '<div class="empty-state-icon">üì≠</div>';
          html += '<p>No events scheduled for this day</p>';
          html += '</div>';
        }

        html += '</div>';
        return html;
      }

      function updateCurrentDate(cal) {
        const date = cal.currentDate;
        const formatted = cal.utils.formatDate(date, 'MMMM yyyy');
        $('#currentDate').text(formatted);
      }

      function updateStats() {
        const cal = $('#calendar').headlessCalendar('getCalendar');
        const allEvents = cal.events;
        const now = new Date();

        $('#totalEvents').text(allEvents.length);

        const thisMonth = allEvents.filter((e) => {
          return (
            e.start.getMonth() === now.getMonth() && e.start.getFullYear() === now.getFullYear()
          );
        });
        $('#monthEvents').text(thisMonth.length);

        const upcoming = allEvents.filter((e) => e.start > now);
        $('#upcomingEvents').text(upcoming.length);

        $('#currentView').text(cal.view);
      }

      function updateEventsList() {
        const cal = $('#calendar').headlessCalendar('getCalendar');
        const allEvents = cal.events;
        const now = new Date();

        const upcoming = allEvents
          .filter((e) => {
            const daysDiff = (e.start - now) / (1000 * 60 * 60 * 24);
            return daysDiff >= 0 && daysDiff <= 30;
          })
          .sort((a, b) => a.start - b.start);

        let html = '';

        if (upcoming.length === 0) {
          html =
            '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>No upcoming events</p></div>';
        } else {
          upcoming.forEach((event) => {
            const dateStr = event.start.toLocaleDateString('en-US', {
              month: 'short',
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit',
            });

            html +=
              '<div class="event-item" data-event-id="' +
              event.id +
              '" style="border-left-color:' +
              event.color +
              ';">';
            html += '<div class="event-item-title">' + event.title + '</div>';
            html += '<div class="event-item-time">' + dateStr + '</div>';
            html += '<div class="event-item-actions">';
            html +=
              '<button class="btn btn-info duplicate-event" data-event-id="' +
              event.id +
              '">Duplicate</button>';
            html +=
              '<button class="btn btn-danger delete-event" data-event-id="' +
              event.id +
              '">Delete</button>';
            html += '</div>';
            html += '</div>';
          });
        }

        $('#eventsList').html(html);
      }

      function updateViewButtons(view) {
        $('.view-switcher button').removeClass('active');
        $(`.view-switcher button[data-view="${view}"]`).addClass('active');
      }

      function showSuccess(message) {
        const $msg = $('<div class="success-message">' + message + '</div>');
        $('body').append($msg);

        setTimeout(function () {
          $msg.fadeOut(300, function () {
            $(this).remove();
          });
        }, 3000);
      }

      function setDefaultDateTime() {
        const now = new Date();
        const tomorrow = new Date(now);
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(now.getHours() + 1);

        $('#eventStart').val(formatDateTimeLocal(now));
        $('#eventEnd').val(formatDateTimeLocal(tomorrow));
      }

      function formatDateTimeLocal(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        return `${year}-${month}-${day}T${hours}:${minutes}`;
      }

      $(document).on('click', '.event-badge, .event-item-title', function (e) {
        e.stopPropagation();
        const eventId = $(this).closest('[data-event-id]').data('event-id');
        showEventDetails(eventId);
      });

      $(document).on('click', '.delete-event', function (e) {
        e.stopPropagation();
        const eventId = $(this).data('event-id');

        if (confirm('Are you sure you want to delete this event?')) {
          $('#calendar').headlessCalendar('deleteEvent', eventId);
          renderCalendar();
          updateStats();
          updateEventsList();
          showSuccess('Event deleted!');
        }
      });

      $(document).on('click', '.duplicate-event', function (e) {
        e.stopPropagation();
        const eventId = $(this).data('event-id');
        $('#calendar').headlessCalendar('duplicateEvent', eventId);
        renderCalendar();
        updateStats();
        updateEventsList();
        showSuccess('Event duplicated!');
      });

      $(document).on('click', '.day-cell', function (e) {
        if ($(e.target).hasClass('event-badge')) return;

        const dateStr = $(this).data('date');
        if (dateStr) {
          const date = new Date(dateStr);
          $('#eventStart').val(formatDateTimeLocal(date));

          const endDate = new Date(date);
          endDate.setHours(date.getHours() + 1);
          $('#eventEnd').val(formatDateTimeLocal(endDate));

          $('html, body').animate(
            {
              scrollTop: $('.event-form').offset().top - 100,
            },
            500,
          );

          $('#eventTitle').focus();
        }
      });

      function showEventDetails(eventId) {
        const event = $('#calendar').headlessCalendar('getEvent', eventId);
        if (!event) return;

        const startStr = event.start.toLocaleString('en-US', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
        });

        const endStr = event.end.toLocaleString('en-US', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
        });

        let html = '<div style="padding:10px;">';
        html +=
          '<div style="background:' +
          event.color +
          ';height:4px;border-radius:2px;margin-bottom:20px;"></div>';
        html += '<div style="margin-bottom:15px;">';
        html += '<strong style="display:block;margin-bottom:5px;">Start:</strong>';
        html += '<span>' + startStr + '</span>';
        html += '</div>';
        html += '<div style="margin-bottom:15px;">';
        html += '<strong style="display:block;margin-bottom:5px;">End:</strong>';
        html += '<span>' + endStr + '</span>';
        html += '</div>';

        if (event.description) {
          html += '<div style="margin-bottom:15px;">';
          html += '<strong style="display:block;margin-bottom:5px;">Description:</strong>';
          html += '<p style="color:#666;">' + event.description + '</p>';
          html += '</div>';
        }

        html += '<div style="display:flex;gap:10px;margin-top:20px;">';
        html +=
          '<button class="btn btn-info duplicate-event" data-event-id="' +
          event.id +
          '">Duplicate</button>';
        html +=
          '<button class="btn btn-danger delete-event" data-event-id="' +
          event.id +
          '">Delete</button>';
        html += '</div>';
        html += '</div>';

        $('#modalTitle').text(event.title);
        $('#modalBody').html(html);
        $('#eventModal').addClass('active');
      }

      setDefaultDateTime();

      console.log('Calendar initialized successfully!');
    });
  </script>
</body>

</html>