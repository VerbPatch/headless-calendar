@if (cal) {
  <h1>Angular Calendar Export Example</h1>

  <div style="display: flex; gap: 20px; align-items: flex-start">
    <div id="calendar" style="flex: 0 0 840px">
      <table
        border="0"
        width="840"
        cellspacing="0"
        style="height: 700px; border-left: 1px solid; border-top: 1px solid"
      >
        <thead>
          <tr>
            <th colspan="2" style="border-bottom: 1px solid">
              <button type="button" (click)="cal.goToPrevious()">←</button>
              <button type="button" (click)="cal.goToToday()">Today</button>
              <button type="button" (click)="cal.goToNext()">→</button>
            </th>
            <th colspan="3" style="border-bottom: 1px solid">
              <h3>
                {{ cal.view === 'month' ? cal.monthData?.monthName : '' }}
                {{ cal.view === 'week' ? cal.weekData?.weekRange : '' }}
                {{ cal.view === 'day' ? cal.dayData?.dayName : '' }}
              </h3>
            </th>
            <th colspan="2" style="border-bottom: 1px solid; border-right: 1px solid">
              <select [value]="cal.view" (change)="changeView($event)" title="Change View">
                <option value="month">Month</option>
                <option value="week">Week</option>
                <option value="day">Day</option>
              </select>
            </th>
          </tr>
        </thead>
        <tbody>
          @if (cal.view == 'month') {
            <tr>
              @for (day of cal.utils.daysofWeek('short'); track day) {
                <th style="width: 120px; border-right: 1px solid; border-bottom: 1px solid">
                  {{ day }}
                </th>
              }
            </tr>
            @for (week of cal.monthData?.weeks; track week) {
              <tr>
                @for (date of week; track date) {
                  <td
                    style="
                      border-right: 1px solid;
                      border-bottom: 1px solid;
                      vertical-align: top;
                      height: 100px;
                    "
                    [ngStyle]="{
                      color: cal.monthData?.isCurrentMonth(date) == false ? 'gray' : '',
                      'font-weight': cal.monthData?.isToday(date) ? 'bold' : 'normal',
                    }"
                  >
                    <div>{{ cal.utils.formatDate(date, 'd') }}</div>
                    @for (e of cal.getEventsForDate(date); track e.id) {
                      <div
                        [style.background]="e.color || '#ccc'"
                        style="font-size: 10px; color: white; margin: 2px 0; padding: 2px"
                      >
                        {{ e.title }}
                      </div>
                    }
                  </td>
                }
              </tr>
            }
          }

          @if (cal.view == 'week' && cal.weekData) {
            <tr>
              <td colspan="7" style="border-right: 1px solid">
                <table cellpadding="5" cellspacing="0" width="100%">
                  <tbody>
                    <tr>
                      <td></td>
                      @for (date of cal.weekData.dates; track date) {
                        <td
                          [ngStyle]="{
                            'font-weight': cal.weekData.isToday(date) ? 'bold' : 'normal',
                          }"
                        >
                          {{ cal.utils.formatDate(date, 'EEE d') }}
                        </td>
                      }
                    </tr>
                    <!-- All Day Row -->
                    <tr>
                      <td style="border-bottom: 1px solid; font-size: 11px">All Day</td>
                      @for (date of cal.weekData.dates; track date) {
                        <td
                          style="
                            border-bottom: 1px solid;
                            border-left: 1px solid;
                            vertical-align: top;
                            background: #fafafa;
                          "
                        >
                          @for (e of getAllDayEvents(date); track e.id) {
                            <div
                              [style.background]="e.color || '#ccc'"
                              style="
                                font-size: 10px;
                                color: white;
                                margin: 1px 0;
                                padding: 2px;
                                border-radius: 2px;
                              "
                            >
                              {{ e.title }}
                            </div>
                          }
                        </td>
                      }
                    </tr>
                    @for (slot of cal.timeSlots; track slot.time) {
                      <tr>
                        <td style="border-bottom: 1px solid">
                          {{ slot.label }}
                        </td>
                        @for (date of cal.weekData.dates; track date) {
                          <td
                            style="
                              border-bottom: 1px solid;
                              border-left: 1px solid;
                              vertical-align: top;
                            "
                            [ngStyle]="{
                              'font-weight': cal.weekData.isToday(date) ? 'bold' : 'normal',
                            }"
                          >
                            @for (e of getEventsAtSlot(date, slot); track e.id) {
                              <div
                                [style.background]="e.color || '#ccc'"
                                style="font-size: 10px; color: white; margin: 1px 0; padding: 2px"
                              >
                                {{ e.title }}
                              </div>
                            }
                          </td>
                        }
                      </tr>
                    }
                  </tbody>
                </table>
              </td>
            </tr>
          }

          @if (cal.view == 'day' && cal.dayData) {
            <tr>
              <td
                colspan="7"
                align="center"
                style="border-right: 1px solid; border-bottom: 1px solid"
              >
                {{ cal.dayData.dayName }}
              </td>
            </tr>
            <tr>
              <td colspan="7" style="border-right: 1px solid">
                <table width="100%" cellspacing="0" style="height: 100%">
                  <tbody>
                    <!-- All Day Row -->
                    @if (getAllDayEvents(cal.dayData.dates[0]).length > 0) {
                      <tr>
                        <td
                          width="25%"
                          style="border-bottom: 1px solid; font-size: 11px; padding: 5px"
                        >
                          All Day
                        </td>
                        <td style="border-bottom: 1px solid; background: #fafafa; padding: 5px">
                          @for (e of getAllDayEvents(cal.dayData.dates[0]); track e.id) {
                            <div
                              [style.background]="e.color || '#ccc'"
                              style="
                                font-size: 10px;
                                color: white;
                                margin: 2px 0;
                                padding: 2px;
                                border-radius: 2px;
                              "
                            >
                              {{ e.title }}
                            </div>
                          }
                        </td>
                      </tr>
                    }
                    @for (slot of cal.timeSlots; track slot.time) {
                      <tr>
                        <td width="25%" style="border-bottom: 1px solid; vertical-align: top">
                          {{ slot.label }}
                        </td>
                        <td style="border-bottom: 1px solid">
                          @for (e of getEventsAtSlot(cal.dayData.dates[0], slot); track e.id) {
                            <div
                              [style.background]="e.color || '#ccc'"
                              style="font-size: 10px; color: white; margin: 1px 0; padding: 2px"
                            >
                              {{ e.title }}
                            </div>
                          }
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <div style="flex: 1; min-width: 300px; font-family: sans-serif">
      <div
        style="
          border: 1px solid #ccc;
          padding: 10px;
          margin-bottom: 20px;
          max-height: 400px;
          overflow-y: auto;
        "
      >
        <h3 style="margin-top: 0">Event List</h3>
        <ul style="padding-left: 20px">
          @for (e of cal.events; track e.id) {
            <li style="margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px">
              <div style="display: flex; align-items: center; gap: 5px">
                <span
                  style="display: inline-block; width: 10px; height: 10px; border-radius: 2px"
                  [style.background-color]="e.color || '#3174ad'"
                ></span>
                <strong>{{ e.title }}</strong>
              </div>
              <div style="font-size: 0.85em; color: #666; margin-left: 15px">
                {{ getEventTimeDisplay(e) }}
              </div>
              @if (e.description) {
                <div
                  style="
                    font-size: 0.8em;
                    color: #555;
                    margin-left: 15px;
                    margin-top: 2px;
                    font-style: italic;
                  "
                >
                  {{ e.description }}
                </div>
              }
              @if (e.recurring && e.recurring !== 'never') {
                <div style="font-size: 0.8em; color: #007bff; margin-top: 2px; margin-left: 15px">
                  {{ formatRecurrence(e.recurring) }}
                  @if (e.exdate && e.exdate.length > 0) {
                    (Excl:
                    @for (d of e.exdate; track d; let last = $last) {
                      {{ cal.utils.formatDate(d) }}{{ last ? '' : ', ' }}
                    }
                    )
                  }
                  @if (e.rdate && e.rdate.length > 0) {
                    (Add:
                    @for (d of e.rdate; track d; let last = $last) {
                      {{ cal.utils.formatDate(d) }}{{ last ? '' : ', ' }}
                    }
                    )
                  }
                </div>
              }
              @if (e.recurrenceId) {
                <div style="font-size: 0.8em; color: #d63384; margin-top: 2px; margin-left: 15px">
                  Recurrence-ID:
                  {{ formatRecurrenceId(e.recurrenceId) }}
                </div>
              }
            </li>
          }
        </ul>
      </div>
      <div style="border: 1px solid #ccc; padding: 10px; max-height: 400px; overflow-y: auto">
        <h3 style="margin-top: 0">
          ICS Output
          <div style="margin-bottom: 10px; float: right">
            <button (click)="cal.downloadICS('my-calendar-events.ics')">Export to ICS</button>
          </div>
        </h3>
        <pre
          style="
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 11px;
            background: #f5f5f5;
            padding: 5px;
          "
          >{{ cal.exportToICS() }}</pre
        >
      </div>
    </div>
  </div>
}
